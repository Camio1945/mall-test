***

# 非原创说明

代码来自 [https://github.com/macrozheng/mall](https://github.com/macrozheng/mall) ，之前忘了 fork 了，想起来的时候发现代码已经对不上了，就采用了复制粘贴老代码的方式。

***

# 仓库说明

针对 mall 电商提交订单的四个接口的性能测试与优化：

登录：/sso/login

购物车列表：/cart/list

生成确认订单：/order/generateConfirmOrder

生成订单：/order/generateOrder

***

# tag 说明

## v1

性能：每秒 33.4 单。

原始代码，没有做任何优化。

## v2

性能：每秒 68.1 单。

做了如下优化：

1. 登录时，把原先安全性较高但是性能较差的加密方式改为了安全性较低但是性能较高的加密方式。
2. 获取购物车列表时增加缓存。
3. 生成确认订单时增加缓存。
4. 生成订单时，其中『删除购物车』这一步操作放到线程中异步执行。
5. 压测之前，先把相关的数据加载到缓存中。

## v3

性能：每秒 78.9 单。

做了如下优化：

1. 把促销信息放入缓存中，见 PmsPortalProductCacheService.java 。

## v4

性能：每秒 78.0 单。（跟上一版相比区别不大）

做了如下调整：

1. 把 MySQL 的 InnoDB 缓冲区大小（innodb_buffer_pool_size）从 128M 调整到 1G。

注：这一版没有修改代码，只是调整了 MySQL 的配置。

## v5

性能：

线程数、爬起时间（rampup）、每秒单数

| 线程数 | 爬起时间（rampup） | 每秒单数  |
|-----|--------------|-------|
| 48  | 5 秒          | 83.0  |
| 48  | 0 秒          | 101.7 |
| 64  | 0 秒          | 97.3  |
| 96  | 0 秒          | 96.3  |

做了如下优化：

1. 在订单表中提前生成订单，后续下单时，对于订单表，不再执行 insert 操作，而是执行 update 操作。（订单商品表还是用的 insert）

